# Technical Specification

This document provides an overview of the internal modules of TicketSorter and describes how the
processing pipeline produces its output files.

## Overview of Modules

- **`main.py`** – command line entry point. It parses arguments and invokes
  `processor.run.run_input` or `processor.run.run_comparison_mode`.
- **`gui.py`** – Tkinter based graphical interface. Calls the same processing
  functions as the CLI in a background thread.
- **`processor/`** – core processing logic:
  - `run.py` orchestrates batch processing and writes summary files.
  - `hybrid_ocr.py` performs OCR, template matching and writes per‐page logs.
  - `file_handler.py` handles output file creation and archiving of the original
    scans.
  - `image_ops.py` contains image extraction utilities.
  - `filename_utils.py` parses and formats file names.
- **`utils/`** – helper utilities for loading configuration, OCR wrappers and
  template loading.
- **`configs.yaml`** – default configuration file used by both CLI and GUI.

## Processing Flow

1. **Input Selection** – The CLI or GUI passes a PDF/TIFF file or a directory
   of documents to `run_input`.
2. **Image Extraction** – Each document is converted to images via
   `processor.image_ops.extract_images_from_file`.
3. **OCR & Vendor Detection** – `processor.hybrid_ocr.process_pages` performs OCR
   on each page and groups pages by vendor using keywords and optional
   template matching.
4. **Export** – Grouped pages are written to vendor folders using
   `processor.file_handler.export_grouped_output`. The original file may be
   moved to an `Original Scans` archive when `rename_original` is enabled.
5. **Logging** – An Excel log and an OCR text log are produced for each file.
   Batch summaries and optional overlay PDFs are created at the end of a run.

## Output Files

The table below lists the main outputs generated by the application. Paths are
relative to the folder containing the input file.

| Output | Location |
| ------ | -------- |
| Vendor PDFs/TIFs | `processed/<input_name>/Vendor/<VENDOR>/...`
| Combined PDF (if output format is PDF) | `processed/<input_name>/Combined/<combined_name>.pdf`
| Per-file log (`TruckingLog.xlsx`) | `logs/<input_name>_TruckingLog.xlsx`
| OCR text log | `ocr_text_log_<timestamp>.csv` (saved next to the input file)
| Batch summary CSV | `batch_summary_<timestamp>.csv` in the current working directory
| OCR overlay PDFs | `ocr_overlay_<timestamp>.pdf` and `_full.pdf` in the working directory
| OCR comparison spreadsheet | `ocr_engine_comparison_<timestamp>.xlsx` in the working directory
| OCR confidence heatmap | `ocr_confidence_scores.png` in the working directory

All output directories are created automatically by
`processor.file_handler.get_dynamic_paths`.

